{{ define "content" }}
<h1>Payment</h1>

{{ if .Order }}
<p><strong>Order ID:</strong> <span id="order-id">{{ .Order.Id }}</span></p>
<p><strong>Status:</strong> <span id="order-status">{{ .Order.Status }}</span></p>
<ul>
    {{ range .Order.Items }}
    <li>Product ID: {{ .ProductId }}</li>
    {{ end }}
</ul>
{{ if eq .Order.Status "AwaitingPayment" }}
<button id="pay-success-btn" type="button">Pay Success</button>
<button id="pay-fail-btn" type="button" style="margin-left: 1em;">Pay Fail</button>
{{ else if eq .Order.Status "Paid" }}
<p>Your order has been paid. Thank you!</p>
{{ else if eq .Order.Status "Failed" }}
<p>Your order has failed. Please try again or contact support.</p>
{{ end }}
<script>
    (function () {
        var orderId = document.getElementById('order-id').textContent;
        var paySuccessBtn = document.getElementById('pay-success-btn');
        if (paySuccessBtn) {
            paySuccessBtn.addEventListener('click', function () {
                sendPaymentRequest('/api/payment-success', { order_id: orderId });
            });
        }

        var payFailBtn = document.getElementById('pay-fail-btn');
        if (payFailBtn) {
            payFailBtn.addEventListener('click', function () {
                sendPaymentRequest('/api/payment-fail', { order_id: orderId });
            });
        }

        function sendPaymentRequest(url, data) {
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
                .then(function (response) {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(function (responseData) {
                    console.log('Payment request successful:', responseData);
                    if (responseData.success) {
                        window.location.href = '/confirmation/' + orderId;
                    }
                })
                .catch(function (error) {
                    console.error('Payment request failed:', error);
                    alert('Payment request failed. Please try again.');
                });
        }
    })();
</script>
{{ else }}
<p>Order not found.</p>
{{ end }}
{{ end }}