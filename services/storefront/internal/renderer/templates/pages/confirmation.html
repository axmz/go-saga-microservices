{{ define "content" }}
<h1>Confirmation</h1>

{{ if .Order }}
<p><strong>Order ID:</strong> <span id="order-id">{{ .Order.ID }}</span></p>
<p><strong>Status:</strong> <span id="order-status">{{ .Order.Status }}</span></p>
<ul>
    {{ range .Order.Items }}
    <li>Product ID: {{ .ProductID }}</li>
    {{ end }}
</ul>
{{ if eq .Order.Status "AwaitingPayment" }}
<p>Your order is awaiting payment or is being processed. Please complete the payment to confirm your order.</p>
{{ else if eq .Order.Status "Processing" }}
<p>Your order is being processed. Service workers are polling the status.</p>
{{ else if eq .Order.Status "Paid" }}
<p>Your order has been paid. Thank you!</p>
{{ else if eq .Order.Status "Failed" }}
<p>Your order has failed. Please try again or contact support.</p>
{{ end }}
<script>
    (function () {
        var orderId = document.getElementById('order-id').textContent;
        var statusEl = document.getElementById('order-status');
        var wsProto = window.location.protocol === 'https:' ? 'wss' : 'ws';
        var wsUrl = wsProto + '://' + window.location.hostname + ':8080/orders/ws?orderId=' + orderId;
        var ws = new WebSocket(wsUrl);
        ws.onmessage = function (event) {
            try {
                var data = JSON.parse(event.data);
                if (data.status) {
                    statusEl.textContent = data.status;
                }
            } catch (e) {
                // fallback for plain text
                statusEl.textContent = event.data;
            }
        };
    })();
</script>
{{ else }}
<p>Order not found.</p>
{{ end }}
{{ end }}