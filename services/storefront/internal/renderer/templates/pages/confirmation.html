{{ define "content" }}
<h1>Confirmation</h1>

{{ if .Order }}
<p><strong>Order ID:</strong> <span id="order-id">{{ .Order.Id }}</span></p>
<p><strong>Status:</strong> <span id="order-status">{{ .Order.Status }} - Status will update shortly via WebSocket</span></p>
<ul>
    {{ range .Order.Items }}
    <li>Product ID: {{ .ProductId }}</li>
    {{ end }}
</ul>
<script>
    (function () {
        var orderId = document.getElementById('order-id').textContent;
        var statusEl = document.getElementById('order-status');
        var wsProto = window.location.protocol === 'https:' ? 'wss' : 'ws';
        var wsUrl = wsProto + '://' + window.location.hostname + ':8080/orders/ws/' + orderId;
        var ws = new WebSocket(wsUrl);
        ws.onmessage = function (event) {
            try {
                var data = JSON.parse(event.data);
                if (data.status) {
                    statusEl.textContent = data.status;
                }
            } catch (e) {
                // fallback for plain text
                statusEl.textContent = event.data;
            }
            ws.close();
        };
        ws.onopen = function () {
            setTimeout(function () {
                ws.close();
            }, 5000);
        };
    })();
</script>
{{ else }}
<p>Order not found.</p>
{{ end }}
{{ end }}